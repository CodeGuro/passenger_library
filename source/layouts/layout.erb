<%
locals = locals.merge(globals)

# We use absolute paths in this template only if the page asked for it,
# e.g. 404.html.erb.
# The reason why we don't use absolute paths everywhere is because we want
# the library to be offline readable without a browser.
if current_page.data.absolute_paths
  def maybe_absolute_url_for(path, options = {})
    config[:url_root] + url_for(path, options.merge(relative: false))
  end
else
  def maybe_absolute_url_for(path, options = {})
    url_for(path, options)
  end
end

def maybe_absolute_link_to(text, path)
  %Q{<a href="#{maybe_absolute_url_for(path)}">#{text}</a>}
end
%>
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <% if page_title %>
      <title><%= page_title %> - <%= site_title %></title>
      <meta name="st:title" content="<%=h page_title %>">
    <% else %>
      <title><%= site_title %></title>
    <% end %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"
/>
    <%= stylesheet_link_tag 'bundle' %>
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400|Open+Sans:400,600" rel="stylesheet" type="text/css">
    <% if current_page.data.skip_search || @skip_search %>
      <meta name="st:robots" content="noindex">
    <% end %>
    <% if locals[:integration_mode_type] %>
      <meta class="swiftype" name="integration_mode" data-type="enum" content="<%= locals[:integration_mode_type] %>">
    <% else %>
      <meta class="swiftype" name="integration_mode" data-type="enum" content="none">
    <% end %>
    <% if locals[:language_type] %>
      <meta class="swiftype" name="language" data-type="enum" content="<%= locals[:language_type] %>">
    <% else %>
      <meta class="swiftype" name="language" data-type="enum" content="none">
    <% end %>
    <% if locals[:edition_type] %>
      <meta class="swiftype" name="edition" data-type="enum" content="<%= locals[:edition_type] %>">
    <% else %>
      <meta class="swiftype" name="edition" data-type="enum" content="none">
    <% end %>
    <% if config[:google_analytics] %>
      <script>
        window.googleAnalyticsEnabled = true;
      </script>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-32583440-10"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-32583440-10', { 'anonymize_ip': true });
      </script>
    <% end %>
    <%= yield_content :head %>
  </head>

  <body class="<%= page_classes %>">

    <!-- Main navigation
    =========================================== -->
    <header id="header">
      <div>
        <ul>
          <a href="https://phusionpassenger.com/"><img src="<%= url_for "/images/passenger_logo.svg" %>" alt="home" /></a>
          <li><%= nav_link('Tutorials', '/tutorials/what_is_passenger/', options: 'header') %></li>
          <li><%= nav_link('Advanced Guides', '/advanced_guides/install_and_upgrade/', options: 'header') %></li>
          <li><%= nav_link('References', '/references/config_reference/', options: 'header') %></li>
          <li><a href="https://www.phusionpassenger.com/library/">Old docs</a></li>
        </ul>
        <img class="small-screen-search" src="<%= url_for "/images/search_icon.svg" %>"  alt="search docs.." />
        <input id="search-bar" type="search" placeholder="search docs.." />
      </div>
    </header>

    <div id="content">

      <!-- Left navigation
      =========================================== -->
      <% if has_sidebar? %>
        <%= yield_sidebar_content %>
      <% else %>
        <div id="left-nav">
          <div id="left-nav-content">
            <img src="https://badge.fury.io/rb/passenger.svg" class="version" alt="gem version"/>

            <%= render_partial("/shared/dropdown", locals: locals.merge(
              dropdown_type: "Language",
              dropdown_items: ['Ruby', 'Python', 'Node', 'Meteor'],
              disabled_items: current_page.data.disabled_langs
            )) %>

            <%= render_partial("/shared/dropdown", locals: locals.merge(
              dropdown_type: "Integration",
              dropdown_items: ['Nginx', 'Apache', 'Standalone']
            )) %>

            <% if current_page.metadata[:page][:section] == "deploy_walkthrough" %>
              <%= render_partial("/shared/dropdown", locals: locals.merge(
                dropdown_type: "Edition",
                dropdown_items: ['OSS', 'Enterprise']
                )) %>

              <%= render_partial("/shared/dropdown", locals: locals.merge(
                dropdown_type: "Platform",
                dropdown_items: ['AWS', 'Heroku', 'Digital Ocean', 'Cloud66', 'Ownserver']
                )) %>
            <% end %>

            <% if current_page.data.references %>
              <%= partial "/shared/references_nav" %>
            <% elsif current_page.data.advanced_guides %>
              <%= partial "/shared/advanced_guides_nav" %>
            <% elsif current_page.data.deploy_walkthrough %>
              <%= partial "/shared/deploy_walkthrough_nav" %>
            <% else %>
              <%= partial "/shared/tutorials_nav" %>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Main content
      =========================================== -->
      <div id="main-content">
        <div>
          <% if current_page.data.breadcrumb == true %>
            <ul id="breadcrumb">
              <li><a href="<%= current_page.parent.url %>"><%= current_page.parent.data.title %></a></li>
              <li><a href="<%= current_page.url %>"><%= current_page.data.title %></a></li>
            </ul>
          <% end %>

          <%= '<section class="bs-docs-section">' if !current_page.data.multisection %>
            <%= yield %>
          <%= '</section>' if !current_page.data.multisection %>
        </div>
      </div>

      <!-- Right sidebar
      =========================================== -->
      <div id="right-content">
        <% if current_page.data.side_toc === true %>
          <%= partial "/shared/side_toc" %>
        <% else %>
          <div>
            <div class="editlink">
              <a href="<%=h current_page_github_url %>"><img src="/images/edit.svg" alt="edit">Edit page</a>
            </div>
          </div>
          <%= partial "/shared/new_items" %>
        <% end %>
      </div>
    </div>

    <footer>
      <div>
        <img src="/images/passenger.svg" alt="Passenger">
        <p>Documentation licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY SA 4.0</a>.</p>
        <ul><li>Follow us on: <a href="https://twitter.com/intent/follow?original_referer=https%3A%2F%2Fwww.phusionpassenger.com%2Flibrary%2F&amp;ref_src=twsrc%5Etfw&amp;screen_name=phusion_nl&amp;tw_p=followbutton"><img src="/images/twitter.svg" alt="twitter"></a></li><li>Passenger: <a href="https://github.com/phusion/passenger"><img src="/images/github.svg" alt="Passenger Github"></a></li><li>Passenger docs: <a href=""><img src="/images/github.svg" alt="Passenger docs Github"></a></li></ul>
        <div>
          <p>Copyright Â© 2008-2018 Phusion Holding B.V. and contributors to the Passenger Library.</p>
          <p>"Phusion", "Phusion Passenger", "Passenger" and the Phusion pinwheel logo are registered trademarks of Phusion Holding B.V.</p>
        </div>
      </div>
    </footer>

    <div id="end_of_page_js">
    <script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <% if !current_page.data.skip_default_javascript %>
    <%= javascript_include_tag 'bundle' %>
    <% end %>

    <%= globals[:layout_body_trailer] || "" %>

    <% if config[:google_analytics] %>
      <script>
        window.__lo_site_id = 54203;
        (function() {
          var wa = document.createElement('script'); wa.type = 'text/javascript'; wa.async = true;
          wa.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://cdn') + '.luckyorange.com/w.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wa, s);
          })();
      </script>
      <script>
        adroll_adv_id = "EGR6J3X3IZEVHJN3CGDVPS";
        adroll_pix_id = "MZKAAVA3MVBWHKNHPWDOKS";
        // adroll_email = "username@example.com"; // OPTIONAL: provide email to improve user identification
        (function () {
            var _onload = function(){
                if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
                if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
                var scr = document.createElement("script");
                var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
                scr.setAttribute('async', 'true');
                scr.type = "text/javascript";
                scr.src = host + "/j/roundtrip.js";
                ((document.getElementsByTagName('head') || [null])[0] ||
                    document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
            };
            if (window.addEventListener) {window.addEventListener('load', _onload, false);}
            else {window.attachEvent('onload', _onload)}
        }());
      </script>
    <% end %>
    </div>
  </body>
</html>
